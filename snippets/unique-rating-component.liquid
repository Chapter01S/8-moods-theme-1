{% comment %}
  Unique Rating Component
  Displays a rating with stars, value, and count in a styled container
{% endcomment %}

{%- liquid
  assign star_color = star_color | default: '#FFE24D'
  assign empty_star_color = empty_star_color | default: '#D3D3D3'
  assign background_start_color = background_start_color | default: '#DFF8FF'
  assign background_end_color = background_end_color | default: '#BFF1FF'
  assign border_color = border_color | default: '#00C7FF'
  assign text_color = text_color | default: '#555555'
  assign rating_value = rating_value | default: '4.8'
  assign rating_count = rating_count | default: '198'
  
  unless star_size
    assign star_size = 15.5
  endunless
  unless star_size_mobile
    assign star_size_mobile = 14
  endunless
  unless text_size
    assign text_size = 11.5
  endunless
  unless text_size_mobile
    assign text_size_mobile = 10.5
  endunless
  unless container_margin_top
    assign container_margin_top = 15
  endunless
  unless container_margin_bottom
    assign container_margin_bottom = -15
  endunless
  unless container_padding_vertical
    assign container_padding_vertical = 4
  endunless
  unless container_padding_horizontal
    assign container_padding_horizontal = 8
  endunless
  unless container_padding_vertical_mobile
    assign container_padding_vertical_mobile = 3
  endunless
  unless container_padding_horizontal_mobile
    assign container_padding_horizontal_mobile = 6
  endunless
  unless border_radius
    assign border_radius = 4
  endunless
  unless star_spacing
    assign star_spacing = 5
  endunless

  assign rating_float = rating_value | plus: 0.0
  assign full_stars = rating_float | floor
  assign has_half_star = false
  assign decimal_part = rating_float | minus: full_stars
  if decimal_part >= 0.25 and decimal_part < 0.75
    assign has_half_star = true
  elsif decimal_part >= 0.75
    assign full_stars = full_stars | plus: 1
  endif
  assign empty_stars = 5 | minus: full_stars
  if has_half_star
    assign empty_stars = empty_stars | minus: 1
  endif
-%}

<div
  class="unique-rating-container unique-rating-{{ block.id }}"
  id="unique-rating-{{ block.id }}"
  {{ block.shopify_attributes }}
  style="
    display: inline-flex;
    align-items: center;
    background: linear-gradient(135deg, {{ background_start_color }}, {{ background_end_color }});
    border: 1px solid {{ border_color }};
  "
>
  <div class="unique-rating-stars" style="display: flex; align-items: center;">
    {%- comment -%} Full stars {%- endcomment -%}
    {% for i in (1..full_stars) %}
      <svg
        class="unique-rating-star"
        width="{{ star_size }}"
        height="{{ star_size }}"
        viewBox="0 0 24 24"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
      >
        <path
          d="M11.5245 3.46353C11.6741 3.00287 12.3259 3.00287 12.4755 3.46353L14.1329 8.56434C14.1998 8.77035 14.3918 8.90983 14.6084 8.90983H19.9717C20.4561 8.90983 20.6575 9.52964 20.2656 9.81434L15.9266 12.9668C15.7514 13.0941 15.678 13.3198 15.745 13.5258L17.4023 18.6266C17.552 19.0873 17.0248 19.4704 16.6329 19.1857L12.2939 16.0332C12.1186 15.9059 11.8814 15.9059 11.7061 16.0332L7.3671 19.1857C6.97524 19.4704 6.448 19.0873 6.59768 18.6266L8.25503 13.5258C8.32197 13.3198 8.24864 13.0941 8.07339 12.9668L3.73438 9.81434C3.34253 9.52964 3.54392 8.90983 4.02828 8.90983H9.39159C9.6082 8.90983 9.80018 8.77035 9.86712 8.56434L11.5245 3.46353Z"
          fill="{{ star_color }}"
        />
      </svg>
    {% endfor %}

    {%- comment -%} Half star {%- endcomment -%}
    {% if has_half_star %}
      <div class="unique-rating-star-half-container">
        <svg
          class="unique-rating-star unique-rating-star-empty"
          width="{{ star_size }}"
          height="{{ star_size }}"
          viewBox="0 0 24 24"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
          style="position: absolute; top: 0; left: 0;"
        >
          <path
            d="M11.5245 3.46353C11.6741 3.00287 12.3259 3.00287 12.4755 3.46353L14.1329 8.56434C14.1998 8.77035 14.3918 8.90983 14.6084 8.90983H19.9717C20.4561 8.90983 20.6575 9.52964 20.2656 9.81434L15.9266 12.9668C15.7514 13.0941 15.678 13.3198 15.745 13.5258L17.4023 18.6266C17.552 19.0873 17.0248 19.4704 16.6329 19.1857L12.2939 16.0332C12.1186 15.9059 11.8814 15.9059 11.7061 16.0332L7.3671 19.1857C6.97524 19.4704 6.448 19.0873 6.59768 18.6266L8.25503 13.5258C8.32197 13.3198 8.24864 13.0941 8.07339 12.9668L3.73438 9.81434C3.34253 9.52964 3.54392 8.90983 4.02828 8.90983H9.39159C9.6082 8.90983 9.80018 8.77035 9.86712 8.56434L11.5245 3.46353Z"
            fill="{{ empty_star_color }}"
          />
        </svg>
        <div
          class="unique-rating-star-half-wrapper"
          style="position: absolute; top: 0; left: 0; width: 50%; height: 100%; overflow: hidden;"
        >
          <svg
            class="unique-rating-star unique-rating-star-filled"
            width="{{ star_size }}"
            height="{{ star_size }}"
            viewBox="0 0 24 24"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              d="M11.5245 3.46353C11.6741 3.00287 12.3259 3.00287 12.4755 3.46353L14.1329 8.56434C14.1998 8.77035 14.3918 8.90983 14.6084 8.90983H19.9717C20.4561 8.90983 20.6575 9.52964 20.2656 9.81434L15.9266 12.9668C15.7514 13.0941 15.678 13.3198 15.745 13.5258L17.4023 18.6266C17.552 19.0873 17.0248 19.4704 16.6329 19.1857L12.2939 16.0332C12.1186 15.9059 11.8814 15.9059 11.7061 16.0332L7.3671 19.1857C6.97524 19.4704 6.448 19.0873 6.59768 18.6266L8.25503 13.5258C8.32197 13.3198 8.24864 13.0941 8.07339 12.9668L3.73438 9.81434C3.34253 9.52964 3.54392 8.90983 4.02828 8.90983H9.39159C9.6082 8.90983 9.80018 8.77035 9.86712 8.56434L11.5245 3.46353Z"
              fill="{{ star_color }}"
            />
          </svg>
        </div>
      </div>
    {% endif %}

    {%- comment -%} Empty stars {%- endcomment -%}
    {% for i in (1..empty_stars) %}
      <svg
        class="unique-rating-star"
        width="{{ star_size }}"
        height="{{ star_size }}"
        viewBox="0 0 24 24"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
      >
        <path
          d="M11.5245 3.46353C11.6741 3.00287 12.3259 3.00287 12.4755 3.46353L14.1329 8.56434C14.1998 8.77035 14.3918 8.90983 14.6084 8.90983H19.9717C20.4561 8.90983 20.6575 9.52964 20.2656 9.81434L15.9266 12.9668C15.7514 13.0941 15.678 13.3198 15.745 13.5258L17.4023 18.6266C17.552 19.0873 17.0248 19.4704 16.6329 19.1857L12.2939 16.0332C12.1186 15.9059 11.8814 15.9059 11.7061 16.0332L7.3671 19.1857C6.97524 19.4704 6.448 19.0873 6.59768 18.6266L8.25503 13.5258C8.32197 13.3198 8.24864 13.0941 8.07339 12.9668L3.73438 9.81434C3.34253 9.52964 3.54392 8.90983 4.02828 8.90983H9.39159C9.6082 8.90983 9.80018 8.77035 9.86712 8.56434L11.5245 3.46353Z"
          fill="{{ empty_star_color }}"
        />
      </svg>
    {% endfor %}
  </div>

  <div
    class="unique-rating-text"
    style="
      color: {{ text_color }};
      font-weight: var(--font-weight-regular);
      line-height: 1.2;
      white-space: nowrap;
    "
  >
    <span class="unique-rating-value">{{ rating_value }}</span>
    <span class="unique-rating-separator" style="margin: 0 2px;">â€¢</span>
    <span class="unique-rating-count">{{ rating_count }}</span>
  </div>
</div>

<style>
  .unique-rating-{{ block.id }} {
    box-sizing: border-box;
    border-radius: {{ border_radius }}px !important;
    padding: {{ container_padding_vertical }}px {{ container_padding_horizontal }}px !important;
    margin-top: {{ container_margin_top }}px !important;
    margin-bottom: {{ container_margin_bottom }}px !important;
    gap: {{ star_spacing }}px !important;
  }

  .unique-rating-{{ block.id }} .unique-rating-stars {
    flex-shrink: 0;
    gap: 2px;
  }

  .unique-rating-{{ block.id }} .unique-rating-star {
    display: block;
    width: {{ star_size }}px !important;
    height: {{ star_size }}px !important;
    flex-shrink: 0;
  }

  .unique-rating-{{ block.id }} .unique-rating-star-half-container {
    position: relative;
    width: {{ star_size }}px !important;
    height: {{ star_size }}px !important;
    flex-shrink: 0;
  }

  .unique-rating-{{ block.id }} .unique-rating-star-half-container .unique-rating-star {
    width: {{ star_size }}px !important;
    height: {{ star_size }}px !important;
  }

  .unique-rating-{{ block.id }} .unique-rating-star-half-wrapper {
    position: absolute;
    top: 0;
    left: 0;
    width: 50%;
    height: 100%;
    overflow: hidden;
  }

  .unique-rating-{{ block.id }} .unique-rating-text {
    flex-shrink: 0;
    font-size: {{ text_size }}px !important;
  }

  .unique-rating-{{ block.id }} .unique-rating-value {
    font-weight: var(--font-weight-semibold);
  }

  {% if mobile_responsive %}
  @media screen and (max-width: 767px) {
    .unique-rating-{{ block.id }} {
      padding: {{ container_padding_vertical_mobile }}px {{ container_padding_horizontal_mobile }}px !important;
    }

    .unique-rating-{{ block.id }} .unique-rating-star {
      width: {{ star_size_mobile }}px !important;
      height: {{ star_size_mobile }}px !important;
    }

    .unique-rating-{{ block.id }} .unique-rating-star-half-container {
      width: {{ star_size_mobile }}px !important;
      height: {{ star_size_mobile }}px !important;
    }

    .unique-rating-{{ block.id }} .unique-rating-star-half-container .unique-rating-star {
      width: {{ star_size_mobile }}px !important;
      height: {{ star_size_mobile }}px !important;
    }

    .unique-rating-{{ block.id }} .unique-rating-text {
      font-size: {{ text_size_mobile }}px !important;
    }
  }
  {% endif %}
</style>