{% comment %}
  Image Rating Snippet

  Parameters:
  - avatar_1: URL for the first avatar image
  - avatar_2: URL for the second avatar image
  - avatar_3: URL for the third avatar image
  - avatar_4: URL for the fourth avatar image
  - avatar_5: URL for the fifth avatar image
  - star_color: Color for the stars
  - empty_star_color: Color for empty/unfilled stars
  - rating_text: Rich text to display (ex: "<p>Excellent</p>")
  - rating_value: Rich text rating value (ex: "<p>4.8</p>")
  - text_color: Text color
  - value_color: Rating value color
  - rating_text_size: Font size for rating text in pixels (default: 14)
  - rating_value_size: Font size for rating value in pixels (default: 14)
  - star_size: Size for star icons in pixels (default: 20)
  - avatar_size: Size for avatar images in pixels (default: 24)
  - layout_order: Order of elements (default: "avatars_text_stars")
  - margin_top: Top margin in pixels
  - margin_bottom: Bottom margin in pixels
  - block: Block object for Shopify block attributes
{% endcomment %}

{% assign avatar_1 = avatar_1 | default: block.settings.avatar_1 %}
{% assign avatar_2 = avatar_2 | default: block.settings.avatar_2 %}
{% assign avatar_3 = avatar_3 | default: block.settings.avatar_3 %}
{% assign avatar_4 = avatar_4 | default: block.settings.avatar_4 %}
{% assign avatar_5 = avatar_5 | default: block.settings.avatar_5 %}
{% assign star_color = star_color | default: block.settings.star_color %}
{% assign empty_star_color = empty_star_color | default: block.settings.empty_star_color | default: '#E0E0E0' %}
{% assign rating_text = rating_text | default: block.settings.rating_text %}
{% assign rating_value = rating_value | default: block.settings.rating_value %}
{% assign text_color = text_color | default: block.settings.text_color %}
{% assign value_color = value_color | default: block.settings.value_color %}
{% assign rating_text_size = rating_text_size | default: block.settings.rating_text_size | default: 14 %}
{% assign rating_value_size = rating_value_size | default: block.settings.rating_value_size | default: 14 %}
{% assign star_size = star_size | default: block.settings.star_size | default: 20 %}
{% assign avatar_size = avatar_size | default: block.settings.avatar_size | default: 24 %}
{% assign layout_order = layout_order | default: block.settings.layout_order | default: 'avatars_text_stars' %}
{% assign margin_top = margin_top | default: block.settings.margin_top %}
{% assign margin_bottom = margin_bottom | default: block.settings.margin_bottom %}

{% comment %} Create reusable components {% endcomment %}
{% capture avatars_component %}
  <div class="imgr-avatar-group">
    {% if avatar_1 != blank %}
      <div class="imgr-avatar"><img src="{{ avatar_1 | img_url: '50x50', crop: 'center' }}" alt="User avatar 1" width="" height=""></div>
    {% endif %}
    {% if avatar_2 != blank %}
      <div class="imgr-avatar"><img src="{{ avatar_2 | img_url: '50x50', crop: 'center' }}" alt="User avatar 2" width="" height=""></div>
    {% endif %}
    {% if avatar_3 != blank %}
      <div class="imgr-avatar"><img src="{{ avatar_3 | img_url: '50x50', crop: 'center' }}" alt="User avatar 3" width="" height=""></div>
    {% endif %}
    {% if avatar_4 != blank %}
      <div class="imgr-avatar"><img src="{{ avatar_4 | img_url: '50x50', crop: 'center' }}" alt="User avatar 4" width="" height=""></div>
    {% endif %}
    {% if avatar_5 != blank %}
      <div class="imgr-avatar"><img src="{{ avatar_5 | img_url: '50x50', crop: 'center' }}" alt="User avatar 5" width="" height=""></div>
    {% endif %}
  </div>
{% endcapture %}

{% capture text_component %}
  <div class="imgr-rating-text-container">
    <div class="imgr-rating-text" style="color: {% if use_theme_colors %}{{ settings.global_section_text_color }}{% else %}{{ text_color }}{% endif %}; font-size: {{ rating_text_size }}px;">{{ rating_text }}</div>
    <div class="imgr-rating-value" style="color: {{ value_color }}; font-size: {{ rating_value_size }}px;">{{ rating_value }}</div>
  </div>
{% endcapture %}

{% capture stars_component %}
  <div class="imgr-stars">
    {% for i in (1..4) %}
      <svg class="imgr-star" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" style="color: {{ star_color }}; width: {{ star_size }}px; height: {{ star_size }}px;">
        <path d="M11.5245 3.46353C11.6741 3.00287 12.3259 3.00287 12.4755 3.46353L14.1329 8.56434C14.1998 8.77035 14.3918 8.90983 14.6084 8.90983H19.9717C20.4561 8.90983 20.6575 9.52964 20.2656 9.81434L15.9266 12.9668C15.7514 13.0941 15.678 13.3198 15.745 13.5258L17.4023 18.6266C17.552 19.0873 17.0248 19.4704 16.6329 19.1857L12.2939 16.0332C12.1186 15.9059 11.8814 15.9059 11.7061 16.0332L7.3671 19.1857C6.97524 19.4704 6.448 19.0873 6.59768 18.6266L8.25503 13.5258C8.32197 13.3198 8.24864 13.0941 8.07339 12.9668L3.73438 9.81434C3.34253 9.52964 3.54392 8.90983 4.02828 8.90983H9.39159C9.6082 8.90983 9.80018 8.77035 9.86712 8.56434L11.5245 3.46353Z" fill="currentColor"/>
      </svg>
    {% endfor %}
    <!-- Half-filled star -->
    <div class="imgr-star-half-container" style="width: {{ star_size }}px; height: {{ star_size }}px;">
      <!-- Full empty star as background -->
      <svg class="imgr-star" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" style="color: {{ empty_star_color }}; position: absolute; width: {{ star_size }}px; height: {{ star_size }}px;">
        <path d="M11.5245 3.46353C11.6741 3.00287 12.3259 3.00287 12.4755 3.46353L14.1329 8.56434C14.1998 8.77035 14.3918 8.90983 14.6084 8.90983H19.9717C20.4561 8.90983 20.6575 9.52964 20.2656 9.81434L15.9266 12.9668C15.7514 13.0941 15.678 13.3198 15.745 13.5258L17.4023 18.6266C17.552 19.0873 17.0248 19.4704 16.6329 19.1857L12.2939 16.0332C12.1186 15.9059 11.8814 15.9059 11.7061 16.0332L7.3671 19.1857C6.97524 19.4704 6.448 19.0873 6.59768 18.6266L8.25503 13.5258C8.32197 13.3198 8.24864 13.0941 8.07339 12.9668L3.73438 9.81434C3.34253 9.52964 3.54392 8.90983 4.02828 8.90983H9.39159C9.6082 8.90983 9.80018 8.77035 9.86712 8.56434L11.5245 3.46353Z" fill="currentColor"/>
      </svg>
      
      <!-- Left half filled star -->
      <div class="imgr-star-half-wrapper" style="position: absolute; width: 50%; height: 100%; overflow: hidden;">
        <svg class="imgr-star" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" style="color: {{ star_color }}; position: absolute; width: {{ star_size }}px; height: {{ star_size }}px;">
          <path d="M11.5245 3.46353C11.6741 3.00287 12.3259 3.00287 12.4755 3.46353L14.1329 8.56434C14.1998 8.77035 14.3918 8.90983 14.6084 8.90983H19.9717C20.4561 8.90983 20.6575 9.52964 20.2656 9.81434L15.9266 12.9668C15.7514 13.0941 15.678 13.3198 15.745 13.5258L17.4023 18.6266C17.552 19.0873 17.0248 19.4704 16.6329 19.1857L12.2939 16.0332C12.1186 15.9059 11.8814 15.9059 11.7061 16.0332L7.3671 19.1857C6.97524 19.4704 6.448 19.0873 6.59768 18.6266L8.25503 13.5258C8.32197 13.3198 8.24864 13.0941 8.07339 12.9668L3.73438 9.81434C3.34253 9.52964 3.54392 8.90983 4.02828 8.90983H9.39159C9.6082 8.90983 9.80018 8.77035 9.86712 8.56434L11.5245 3.46353Z" fill="currentColor"/>
        </svg>
      </div>
    </div>
  </div>
{% endcapture %}

<div
  class="imgr-container imgr-layout-{{ layout_order }}"
  {{ block.shopify_attributes }}
  style="margin-top: {{ margin_top }}px; margin-bottom: {{ margin_bottom }}px;"
>
  {% case layout_order %}
    {% when 'avatars_text_stars' %}
      {{ avatars_component }}
      {{ text_component }}
      {{ stars_component }}
    {% when 'avatars_stars_text' %}
      {{ avatars_component }}
      {{ stars_component }}
      {{ text_component }}
    {% when 'text_avatars_stars' %}
      {{ text_component }}
      {{ avatars_component }}
      {{ stars_component }}
    {% when 'text_stars_avatars' %}
      {{ text_component }}
      {{ stars_component }}
      {{ avatars_component }}
    {% when 'stars_avatars_text' %}
      {{ stars_component }}
      {{ avatars_component }}
      {{ text_component }}
    {% when 'stars_text_avatars' %}
      {{ stars_component }}
      {{ text_component }}
      {{ avatars_component }}
    {% else %}
      {{ avatars_component }}
      {{ text_component }}
      {{ stars_component }}
  {% endcase %}
</div>

<style>
  .imgr-container {
    display: flex;
    align-items: center;
    width: max-content;
    max-width: none;
    position: relative;
    z-index: 1;
    white-space: nowrap;
  }

  .imgr-avatar-group {
    display: flex;
    margin-right: 12px;
    align-items: center;
    flex-shrink: 0;
  }

  .imgr-avatar {
    width: {{ avatar_size }}px;
    height: {{ avatar_size }}px;
    border-radius: 50%;
    border: 1.5px solid white;
    margin-right: calc(-{{ avatar_size }}px * 0.4);
    overflow: hidden;
    position: relative;
  }

  .imgr-avatar:nth-child(1) { z-index: 5; }
  .imgr-avatar:nth-child(2) { z-index: 4; }
  .imgr-avatar:nth-child(3) { z-index: 3; }
  .imgr-avatar:nth-child(4) { z-index: 2; }
  .imgr-avatar:nth-child(5) { z-index: 1; }

  .imgr-avatar img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .imgr-rating-text-container {
    display: flex;
    align-items: center;
    margin-right: 12px;
    margin-left: 4px;
    flex-shrink: 0;
    white-space: nowrap;
  }

  .imgr-rating-text {
    font-weight: var(--font-weight-semibold);
    line-height: 1;
    white-space: nowrap;
  }

  .imgr-rating-text p {
    margin: 0;
    display: inline;
    white-space: nowrap;
  }

  .imgr-rating-text p strong,
  .imgr-rating-text p b {
    font-weight: var(--font-weight-bold);
    white-space: nowrap;
  }

  .imgr-rating-value {
    font-weight: var(--font-weight-regular);
    margin-left: 3px;
    line-height: 1;
    white-space: nowrap;
  }

  .imgr-rating-value p {
    margin: 0;
    display: inline;
    white-space: nowrap;
  }

  .imgr-rating-value p strong,
  .imgr-rating-value p b {
    font-weight: var(--font-weight-bold);
    white-space: nowrap;
  }

  .imgr-stars {
    display: flex;
    align-items: center;
    flex-shrink: 0;
  }

  .imgr-star {
    width: {{ star_size }}px;
    height: {{ star_size }}px;
    flex-shrink: 0;
    margin-right: calc(-{{ star_size }}px * 0.25);
  }

  .imgr-star-half-container {
    position: relative;
    width: {{ star_size }}px;
    height: {{ star_size }}px;
    flex-shrink: 0;
    margin-right: calc(-{{ star_size }}px * 0.25);
  }

  .imgr-star-half-wrapper {
    position: absolute;
    top: 0;
    left: 0;
    width: 50%;
    height: 100%;
    overflow: hidden;
  }

  /* Mobile responsive styles - 85% scale for better readability */
  @media screen and (max-width: 767px) {
    .imgr-container {
      width: max-content;
      max-width: none;
      white-space: nowrap;
    }

    .imgr-avatar-group {
      margin-right: calc(12px * 0.85);
    }

    .imgr-avatar {
      width: calc({{ avatar_size }}px * 0.85);
      height: calc({{ avatar_size }}px * 0.85);
      border: 1px solid white;
      margin-right: calc(-{{ avatar_size }}px * 0.4 * 0.85);
    }

    .imgr-rating-text-container {
      margin-right: calc(12px * 0.85);
      margin-left: calc(4px * 0.85);
    }

    .imgr-rating-text {
      font-size: calc({{ rating_text_size }}px * 0.9) !important;
    }

    .imgr-rating-value {
      font-size: calc({{ rating_value_size }}px * 0.9) !important;
    }

    .imgr-star,
    .imgr-star-half-container {
      width: calc({{ star_size }}px * 0.85) !important;
      height: calc({{ star_size }}px * 0.85) !important;
      margin-right: calc(-{{ star_size }}px * 0.25 * 0.85);
    }

    .imgr-star-half-container svg {
      width: calc({{ star_size }}px * 0.85) !important;
      height: calc({{ star_size }}px * 0.85) !important;
    }
  }
</style>
