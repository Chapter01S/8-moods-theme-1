{% comment %}
  Component: Benefits Grid
  
  Usage: 
  {% render 'component-benefits-grid', 
     benefits: section.blocks,
     heading: 'Your Benefits',
     subtitle: 'Why choose us',
     image: section.settings.section_image,
     layout: 'grid' %}
  
  Parameters:
  - benefits: array of benefit blocks (required)
  - heading: string (optional)
  - subtitle: string (optional) 
  - image: image object (optional)
  - layout: 'grid' or 'row' (default: 'grid')
  - section_id: string for unique styling (optional)
{% endcomment %}

{{ 'component-benefits-grid.css' | asset_url | stylesheet_tag }}

{%- liquid
  assign has_image = false
  if image != blank
    assign has_image = true
  endif
  assign section_id = section_id | default: 'benefits'
  assign layout = layout | default: 'grid'
  assign image_display_mode = image_display_mode | default: 'standard'
  assign mobile_image_position = mobile_image_position | default: 'after_header'
-%}

<div class="benefits-grid" data-component="benefits-grid" data-layout="{{ layout }}" data-image-mode="{{ image_display_mode }}" id="benefits-{{ section_id }}" {% if image_display_mode == 'background' and has_image %}style="background-image: url('{{ image | image_url: width: 1600 }}');"{% endif %}>
  <div class="benefits-grid__container">
    
    <!-- Content Layout -->
    <div class="benefits-grid__content-wrapper{% unless has_image or image_display_mode == 'background' %} benefits-grid__content-wrapper--no-image{% endunless %}">
      
      <!-- Benefits Content -->
      <div class="benefits-grid__content">
        
        <!-- Image (Mobile: before header) -->
        {% if has_image and mobile_image_position == 'before_header' and image_display_mode != 'background' %}
          <div class="benefits-grid__image benefits-grid__image--mobile benefits-grid__image--before-header">
            <img 
              src="{{ image | image_url: width: 1200 }}" 
              srcset="{{ image | image_url: width: 600 }} 600w,
                      {{ image | image_url: width: 800 }} 800w,
                      {{ image | image_url: width: 1000 }} 1000w,
                      {{ image | image_url: width: 1200 }} 1200w"
              sizes="(max-width: 767px) 100vw, 50vw"
              alt="{{ image.alt | default: 'Benefits illustration' | escape }}"
              class="benefits-grid__image-element"
              loading="lazy"
              width="{{ image.width }}"
              height="{{ image.height }}">
          </div>
        {% endif %}
        
        {% comment %} Mobile placeholder for background mode (before header position) {% endcomment %}
        {% if image_display_mode == 'background' and mobile_image_position == 'before_header' %}
          <!-- DEBUG: Mobile placeholder rendering (before header) -->
          <div class="benefits-grid__image benefits-grid__image--mobile benefits-grid__image--mobile-placeholder" 
               data-position="before-header" 
               data-display-mode="{{ image_display_mode }}"
               data-mobile-position="{{ mobile_image_position }}"></div>
        {% endif %}
        
        <!-- Header -->
        {% if heading != blank or subtitle != blank %}
          <div class="benefits-grid__header">
            {% if heading != blank %}
              <h2 class="benefits-grid__heading">
                {{ heading }}
                {% if heading_accent != blank %}
                  <span class="benefits-grid__heading-accent">{{ heading_accent }}</span>
                {% endif %}
              </h2>
            {% endif %}
            {% if subtitle != blank %}
              <p class="benefits-grid__subtitle">{{ subtitle }}</p>
            {% endif %}
          </div>
        {% endif %}

        <!-- Image (Mobile: after header / between header and benefits) -->
        {% if has_image and mobile_image_position != 'before_header' and image_display_mode != 'background' %}
          <div class="benefits-grid__image benefits-grid__image--mobile benefits-grid__image--after-header">
            <img 
              src="{{ image | image_url: width: 1200 }}" 
              srcset="{{ image | image_url: width: 600 }} 600w,
                      {{ image | image_url: width: 800 }} 800w,
                      {{ image | image_url: width: 1000 }} 1000w,
                      {{ image | image_url: width: 1200 }} 1200w"
              sizes="(max-width: 767px) 100vw, 50vw"
              alt="{{ image.alt | default: 'Benefits illustration' | escape }}"
              class="benefits-grid__image-element"
              loading="lazy"
              width="{{ image.width }}"
              height="{{ image.height }}">
          </div>
        {% endif %}
        
        {% comment %} Mobile placeholder for background mode (after header position) {% endcomment %}
        {% if image_display_mode == 'background' and mobile_image_position != 'before_header' %}
          <!-- DEBUG: Mobile placeholder rendering (after header) -->
          <div class="benefits-grid__image benefits-grid__image--mobile benefits-grid__image--mobile-placeholder" 
               data-position="after-header"
               data-display-mode="{{ image_display_mode }}"
               data-mobile-position="{{ mobile_image_position }}"></div>
        {% endif %}

        <!-- Benefits Items -->
        <div class="benefits-grid__items" data-layout="{{ layout }}">
          {% for benefit in benefits limit: 4 %}
            {% render 'component-benefit-item', 
               benefit: benefit, 
               index: forloop.index,
               section_id: section_id %}
          {% endfor %}
        </div>
      </div>

      <!-- Image (Desktop: side by side) -->
      {% if has_image and image_display_mode != 'background' %}
        <div class="benefits-grid__image benefits-grid__image--desktop">
          <img 
            src="{{ image | image_url: width: 1200 }}" 
            srcset="{{ image | image_url: width: 600 }} 600w,
                    {{ image | image_url: width: 800 }} 800w,
                    {{ image | image_url: width: 1000 }} 1000w,
                    {{ image | image_url: width: 1200 }} 1200w"
            sizes="(max-width: 767px) 100vw, 50vw"
            alt="{{ image.alt | default: 'Benefits illustration' | escape }}"
            class="benefits-grid__image-element"
            loading="lazy"
            width="{{ image.width }}"
            height="{{ image.height }}">
        </div>
      {% endif %}
      
      {% comment %} Show placeholder whenever in background mode, regardless of has_image {% endcomment %}
      {% if image_display_mode == 'background' %}
        <!-- DEBUG: Placeholder rendering in background mode -->
        <div class="benefits-grid__image benefits-grid__image--desktop benefits-grid__image--placeholder" 
             data-display-mode="{{ image_display_mode }}" 
             data-has-image="{{ has_image }}"></div>
      {% endif %}
    </div>
  </div>
</div>